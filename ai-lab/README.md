# AI Image Generator – Flask + Azure OpenAI

A modern web application that lets you **upload an image, describe a transformation**, and receive a brand-new image generated by Azure OpenAI (DALL·E / GPT-image-1 Edit API). The UI provides live previews, skeleton loaders, and a responsive side-by-side layout so users can easily compare the uploaded image with the generated result.

---

## Table of Contents
1. [Demo](#demo)
2. [Architecture](#architecture)
3. [Quick Start](#quick-start)
4. [Environment Variables](#environment-variables)
5. [Project Structure](#project-structure)
6. [How It Works](#how-it-works)
7. [Customization](#customization)
8. [Troubleshooting](#troubleshooting)

---

## Demo
```
$ python main.py
 * Running on http://127.0.0.1:5000
```
Open your browser ➜ upload a picture ➜ type a prompt ➜ click **Generate** ➜ watch the skeleton loader morph into your AI-generated image.

---

## Architecture
```
client (HTML/CSS/JS)  ──►  Flask routes (main.py)  ──►  Generator service  ──►  Azure OpenAI
        ▲                        │                               │
        └──────────── Preview, Spinner, Skeleton ◄───────────────┘
```
• **main.py** – minimal Flask entry; delegates all heavy lifting to services.  
• **services/**  
  • `generator.py` – orchestrates upload → OpenAI call.  
  • `azure_openai.py` – wraps REST API (multipart form-data for *Image Edit*).  
• **utils/** – helpers (`file_utils.py`) for validation & file saving.  
• **static/** – UI assets (`style.css`, `preview.js`, `app.js`).  

---

## Quick Start

### 1. Clone the repo and change to the ai-lab directory
You can get the repo URL from GitHub Web
```bash
git clone ....
cd ai-lab
```

### 2. Create virtual Python environment and activate it
This is necessary so that it doesnt install unnecessary things to your computer
```bash
python -m venv .venv
.venv\Scripts\activate
```

### 3. Install python libraries that are dependencies for the project
```bash
pip install -r requirements.txt
```

### 4. Create and Edit the configuration environment file
The app cannot run without these parameters.
```bash
copy .env.example .env   # then fill values (see below)
```

### 5. Run the app and launch it in your Browser
```bash
python main.py
```
Navigate to `http://localhost:5000` (or the URL provided in the console)

---

## About the Environment Variables file
Create a `.env` file in `final-version/` with:
```
AZURE_OPENAI_ENDPOINT=https://<resource>.openai.azure.com/openai/deployments/<deployment>/images/generations?api-version=2025-04-01-preview
AZURE_OPENAI_API_KEY=<your-key>
```
The code automatically converts the *Generations* endpoint to the required *Edits* endpoint.

---

## Project Structure
```
final-version/
├── main.py                 # Flask routes (≤40 lines!)
├── requirements.txt        # Dependencies
├── .env.example            # Sample env file
│
├── services/               # Business logic
│   ├── __init__.py
│   ├── generator.py        # save + call OpenAI
│   └── azure_openai.py     # REST wrapper
│
├── utils/
│   ├── __init__.py
│   └── file_utils.py       # file validation helpers
│
├── templates/
│   └── index.html          # UI markup
│
└── static/
    ├── style.css           # Styling & animations
    ├── preview.js          # Client-side image preview
    ├── app.js              # Form submit, spinner, skeleton
    ├── uploads/            # Saved uploads
    └── generated/          # AI-generated images
```

---

## How It Works
1. **Upload & Preview** – `preview.js` shows the local image immediately (FileReader API).  
2. **Generate** – `app.js` sends a `POST /generate` AJAX request with `FormData` (file + prompt). Button turns into a spinner and skeleton placeholder appears matching the uploaded image size.
3. **Back-end flow**  
  a. `main.py` ➜ `services.generator.generate_from_upload()`  
  b. File saved via `utils.file_utils.save_upload()`  
  c. `services.azure_openai.AzureOpenAIService.generate_image()` uploads the image to Azure OpenAI *Image Edit* API (multipart form-data) and returns either a URL or base64 payload.  
  d. Base64 results are persisted to `static/generated/` and served locally.  
4. Front-end replaces the skeleton with the real image once the JSON response arrives.

---

## Customization
• **Model settings** – Edit `services/azure_openai.py` (size, n, etc.).  
• **Styling** – Tweak `static/style.css` (responsive flex layout, skeleton animation).  
• **Deployment** – Disable `debug=True` in `main.py` and serve via Gunicorn/uvicorn behind Nginx.

---

## Troubleshooting
| Issue                                          | Fix                                                                       |
| ---------------------------------------------- | ------------------------------------------------------------------------- |
| *ImportError relative import beyond top-level* | Ensure `services/` and `utils/` contain `__init__.py`.                    |
| 400 *unknown_parameter*                        | Azure API changed – remove unsupported fields (already handled).          |
| 403 / 401                                      | Check API key & resource permissions.                                     |
| Images not served                              | Verify `static/uploads` & `static/generated` exist and Flask static path. |

---

**Enjoy generating magic with Azure OpenAI!**
